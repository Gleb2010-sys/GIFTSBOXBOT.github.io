<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Мой Telegram Профиль</title>
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
    }

    html, body {
        overflow-x: hidden;
        position: fixed;
        width: 100%;
        height: 100%;
    }

    body {
        font-family: 'Arial', sans-serif;
        min-height: 100vh;
        padding: 20px;
        background: linear-gradient(135deg, #000000);
        touch-action: pan-x pan-y;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .profile-card {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4a 50%, #ffd700 100%);
        border-radius: 20px;
        padding: 20px;
        max-width: 400px;
        width: 100%;
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        border: 2px solid #ffed4a;
        position: relative;
        overflow: hidden;
    }

    .profile-card::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transform: rotate(45deg);
        animation: shine 3s infinite;
    }

    @keyframes shine {
        0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
        border: 3px solid #000000;
        margin-right: 20px;
        background: linear-gradient(135deg, #000000 0%, #333333 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffd700;
        font-size: 28px;
        font-weight: bold;
        flex-shrink: 0;
        -webkit-user-drag: none;
        user-drag: none;
        pointer-events: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        position: relative;
        z-index: 2;
    }

    .user-info {
        flex: 1;
        text-align: left;
        min-width: 0;
        position: relative;
        z-index: 2;
    }

    .username {
        font-size: 22px;
        font-weight: bold;
        color: #000000;
        margin-bottom: 8px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
    }

    .user-id {
        font-size: 16px;
        color: #333333;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-weight: 600;
    }

    .token-balance {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border-radius: 20px;
        padding: 25px 20px;
        max-width: 400px;
        width: 100%;
        text-align: center;
        margin-bottom: 30px;
        position: relative;
        box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        border: 2px solid #ffd700;
    }

    .balance-amount {
        font-size: 42px;
        font-weight: bold;
        color: #ffd700;
        margin-bottom: 8px;
        text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        background: linear-gradient(45deg, #ffd700, #ffed4a, #ffd700);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-size: 200% 200%;
        animation: shimmer 2s ease-in-out infinite;
    }

    @keyframes shimmer {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .token-name {
        font-size: 18px;
        color: #ffed4a;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .admin-refresh-button {
        position: absolute;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, #ffd700 0%, #ffed4a 100%);
        color: #000000;
        border: none;
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        border: 2px solid #000000;
    }

    .admin-refresh-button:hover {
        background: linear-gradient(135deg, #ffed4a 0%, #ffff80 100%);
        transform: scale(1.05);
    }

    .admin-refresh-button:active {
        transform: scale(0.95);
    }

    .admin-reset-button {
        position: absolute;
        top: 15px;
        left: 15px;
        background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 68, 68, 0.4);
        border: 2px solid #ffffff;
    }

    .admin-reset-button:hover {
        background: linear-gradient(135deg, #ff6666 0%, #ff8888 100%);
        transform: scale(1.05);
    }

    .admin-reset-button:active {
        transform: scale(0.95);
    }

    .navigation {
        display: flex;
        gap: 12px;
        max-width: 400px;
        width: 100%;
        margin-bottom: 20px;
    }

    .nav-button {
        flex: 1;
        background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
        color: #ffd700;
        border: 2px solid #ffd700;
        padding: 14px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
    }

    .nav-button.active {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4a 100%);
        color: #000000;
        border-color: #000000;
        box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
    }

    .nav-button:hover:not(.active) {
        background: linear-gradient(135deg, #3d3d3d 0%, #2a2a2a 100%);
        transform: translateY(-2px);
    }

    .page {
        margin-top: 20px;
        display: none;
        max-width: 400px;
        width: 100%;
    }

    .page.active {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 200px);
    }

    /* Mining Section */
    .mining-container {
        text-align: center;
        margin-bottom: 20px;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border-radius: 20px;
        padding: 25px;
        border: 2px solid #ffd700;
        box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
    }

    .mining-time {
        font-size: 18px;
        color: #ffd700;
        font-weight: bold;
        margin: 15px 0;
        text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    .mining-progress {
        width: 100%;
        height: 25px;
        background: #000000;
        border-radius: 12px;
        margin: 20px 0;
        overflow: hidden;
        border: 2px solid #ffd700;
        position: relative;
    }

    .mining-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #ff6b35, #ffd700, #ffed4a);
        border-radius: 10px;
        transition: width 0.5s ease;
        position: relative;
        overflow: hidden;
    }

    .mining-progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .mining-stats {
        display: flex;
        justify-content: space-between;
        color: #ffed4a;
        font-size: 14px;
        margin-top: 15px;
        font-weight: 600;
    }

    .mine-button {
        margin-top: 15px;
        background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
        color: #000000;
        border: none;
        padding: 16px 40px;
        border-radius: 30px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        border: 2px solid #000000;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .mine-button:disabled {
        background: linear-gradient(135deg, #666666 0%, #888888 100%);
        cursor: not-allowed;
        box-shadow: none;
        color: #cccccc;
    }

    .mine-button:active:not(:disabled) {
        transform: scale(0.95);
    }

    .mine-button:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 107, 53, 0.6);
    }

    /* Boxes Section */
    .boxes-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 20px;
        max-width: 400px;
        width: 100%;
    }

    .box-item {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        border: 2px solid #ffd700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 6px 20px rgba(255, 215, 0, 0.2);
        position: relative;
        overflow: hidden;
    }

    .box-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ffd700, #ffed4a, #ffd700);
    }

    .box-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
    }

    .box-item:active {
        transform: scale(0.95);
    }

    .box-icon {
        font-size: 48px;
        margin-bottom: 15px;
        filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
    }

    .box-name {
        font-size: 16px;
        color: #ffed4a;
        margin-bottom: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .box-price {
        font-size: 20px;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
    }

    /* Inventory Section */
    .inventory-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        border-radius: 20px;
        padding: 20px;
        border: 2px solid #ffd700;
        box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
    }

    .inventory-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 20px;
        overflow-y: auto;
        max-height: calc(100vh - 350px);
        padding-right: 8px;
        touch-action: pan-y;
    }

    .inventory-grid::-webkit-scrollbar {
        width: 8px;
    }

    .inventory-grid::-webkit-scrollbar-track {
        background: #000000;
        border-radius: 4px;
    }

    .inventory-grid::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4a 100%);
        border-radius: 4px;
    }

    .inventory-grid::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #ffed4a 0%, #ffff80 100%);
    }

    .inventory-item {
        background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
        border-radius: 15px;
        padding: 15px;
        text-align: center;
        border: 2px solid #ffd700;
        position: relative;
        min-height: 140px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
    }

    .inventory-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(255, 215, 0, 0.3);
    }

    .inventory-image {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 8px;
        border: 2px solid #ffd700;
        -webkit-user-drag: none;
        user-drag: none;
        pointer-events: none;
    }

    .item-value {
        font-size: 14px;
        color: #ffd700;
        font-weight: bold;
        margin-bottom: 8px;
        text-shadow: 0 0 3px rgba(255, 215, 0, 0.5);
    }

    .sell-button {
        background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
        color: #000000;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 5px;
        width: 100%;
        border: 1px solid #000000;
        transition: all 0.3s ease;
    }

    .sell-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
    }

    .withdraw-button {
        background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
        color: #000000;
        border: none;
        padding: 18px;
        border-radius: 15px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s ease;
        margin-top: auto;
        border: 2px solid #000000;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
    }

    .withdraw-button:disabled {
        background: linear-gradient(135deg, #666666 0%, #888888 100%);
        cursor: not-allowed;
        color: #cccccc;
        box-shadow: none;
    }

    .withdraw-button:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(255, 107, 53, 0.6);
    }

    .empty-inventory {
        text-align: center;
        color: #ffed4a;
        font-size: 18px;
        padding: 50px 20px;
        grid-column: 1 / -1;
        font-weight: 600;
    }

    .special-bonus {
        color: #ff6b35;
        font-size: 14px;
        margin-top: 8px;
        font-weight: bold;
        text-shadow: 0 0 3px rgba(255, 107, 53, 0.5);
    }

    /* Modal Styles */
    .confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .confirmation-content {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        padding: 30px;
        border-radius: 20px;
        text-align: center;
        max-width: 320px;
        width: 90%;
        border: 3px solid #ffd700;
        box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
    }

    .confirmation-text {
        color: #ffed4a;
        margin-bottom: 25px;
        font-size: 16px;
        line-height: 1.5;
        font-weight: 600;
    }

    .confirmation-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    .confirm-button {
        background: linear-gradient(135deg, #ff4444 0%, #ff6666 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        border: 2px solid #ffffff;
        transition: all 0.3s ease;
    }

    .cancel-button {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4a 100%);
        color: #000000;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        border: 2px solid #000000;
        transition: all 0.3s ease;
    }

    .confirm-button:hover,
    .cancel-button:hover {
        transform: scale(1.05);
    }

    .no-copy {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        -webkit-user-drag: none;
        user-drag: none;
        pointer-events: none;
    }

    .timer {
        font-size: 14px;
        color: #ffed4a;
        margin-top: 10px;
        font-weight: 600;
    }
</style>
</head>
<body>
    <div class="profile-card">
        <div class="avatar no-copy" id="avatar">U</div>
        <div class="user-info">
            <div class="username" id="username">Пользователь</div>
            <div class="user-id" id="user-id">ID: не указан</div>
            <div class="special-bonus" id="specialBonus"></div>
        </div>
    </div>

    <div class="navigation">
        <button class="nav-button active" onclick="showPage('main')">Главная</button>
        <button class="nav-button" onclick="showPage('boxes')">Боксы</button>
        <button class="nav-button" onclick="showPage('inventory')">Инвентарь</button>
    </div>

    <div class="page active" id="main-page">
        <div class="token-balance">
            <div class="balance-amount" id="balance">0</div>
            <div class="token-name">Звёзд</div>
            <button class="admin-refresh-button" id="adminRefreshButton" style="display: none;">+5000 🎯</button>
            <button class="admin-reset-button" id="adminResetButton" style="display: none;">Сброс 🔄</button>
        </div>

        <div class="mining-container">
            <div class="mining-time" id="miningTime">Майнинг не запущен</div>
            <div class="mining-progress">
                <div class="mining-progress-bar" id="miningProgressBar" style="width: 0%"></div>
            </div>
            <div class="mining-stats">
                <span id="minedAmount">Добыто: 0</span>
                <span id="nextReward">Следующая награда: 00:10:00</span>
            </div>
            <button class="mine-button" id="mineButton">Начать майнинг</button>
            <div class="timer" id="timer"></div>
        </div>
    </div>

    <div class="page" id="boxes-page">
        <div class="boxes-container">
            <div class="box-item" onclick="openBox(150)">
                <div class="box-icon">📦</div>
                <div class="box-name">Обычный бокс</div>
                <div class="box-price">150 звёзд</div>
            </div>
            <div class="box-item" onclick="openBox(300)">
                <div class="box-icon">🎁</div>
                <div class="box-name">Редкий бокс</div>
                <div class="box-price">300 звёзд</div>
            </div>
            <div class="box-item" onclick="openBox(500)">
                <div class="box-icon">💎</div>
                <div class="box-name">Эпический бокс</div>
                <div class="box-price">500 звёзд</div>
            </div>
            <div class="box-item" onclick="openBox(1000)">
                <div class="box-icon">👑</div>
                <div class="box-name">Легендарный бокс</div>
                <div class="box-price">1000 звёзд</div>
            </div>
        </div>
    </div>

    <div class="page" id="inventory-page">
        <div class="token-balance">
            <div class="balance-amount" id="inventory-count">0</div>
            <div class="token-name">пусто</div>
        </div>

        <div class="inventory-container">
            <div class="inventory-grid" id="inventory-grid">
                <div class="empty-inventory">Инвентарь пуст</div>
            </div>
            <button class="withdraw-button" id="withdrawButton" disabled>Вывести звёзды</button>
        </div>
    </div>

    <div class="confirmation-modal" id="resetModal">
        <div class="confirmation-content">
            <div class="confirmation-text">Вы уверены, что хотите сбросить все данные? Это действие нельзя отменить!</div>
            <div class="confirmation-buttons">
                <button class="confirm-button" onclick="confirmReset()">Да, сбросить</button>
                <button class="cancel-button" onclick="cancelReset()">Отмена</button>
            </div>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        document.addEventListener('contextmenu', function(e) {
            if (e.target.tagName === 'IMG' || e.target.classList.contains('no-copy')) {
                e.preventDefault();
                return false;
            }
        });

        document.addEventListener('dragstart', function(e) {
            if (e.target.tagName === 'IMG' || e.target.classList.contains('no-copy')) {
                e.preventDefault();
                return false;
            }
        });

        document.addEventListener('selectstart', function(e) {
            if (e.target.tagName === 'IMG' || e.target.classList.contains('no-copy')) {
                e.preventDefault();
                return false;
            }
        });

        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        document.addEventListener('touchmove', function(e) {
            if(e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });

        let user = null;
        
        if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;
            tg.expand();
            user = tg.initDataUnsafe.user;
        }

        const MY_TELEGRAM_ID = '8419434460';

        function getUserKey() {
            if (user && user.id) {
                return `user_${user.id}`;
            }
            return 'user_anonymous';
        }

        function initializeUser() {
            const userKey = getUserKey();
            const existingData = localStorage.getItem(userKey);
            
            if (existingData) {
                try {
                    const parsedData = JSON.parse(existingData);
                    return parsedData;
                } catch (e) {
                    console.error('Ошибка парсинга данных:', e);
                    return createNewUserData();
                }
            }
            
            return createNewUserData();
        }

        function createNewUserData() {
            const isOwner = user && user.id && user.id.toString() === MY_TELEGRAM_ID;
            const initialTokens = isOwner ? 5000 : 100;
            
            const newUserData = {
                tokens: initialTokens,
                inventory: [],
                initialized: true,
                isSpecialUser: isOwner,
                mining: {
                    active: false,
                    startTime: null,
                    totalMined: 0,
                    lastRewardTime: null
                }
            };
            
            const userKey = getUserKey();
            localStorage.setItem(userKey, JSON.stringify(newUserData));
            console.log('Новый пользователь создан:', isOwner ? 'Владелец (5000)' : 'Обычный (100)');
            return newUserData;
        }

        function getUserData() {
            return initializeUser();
        }

        function saveUserData(data) {
            const userKey = getUserKey();
            
            try {
                localStorage.setItem(userKey, JSON.stringify(data));
                console.log('Данные успешно сохранены');
                return true;
            } catch (error) {
                console.error('Ошибка сохранения данных:', error);
                return false;
            }
        }

        function resetUserData() {
            const userKey = getUserKey();
            const isOwner = user && user.id && user.id.toString() === MY_TELEGRAM_ID;
            
            const resetData = {
                tokens: isOwner ? 5000 : 100,
                inventory: [],
                initialized: true,
                isSpecialUser: isOwner,
                mining: {
                    active: false,
                    startTime: null,
                    totalMined: 0,
                    lastRewardTime: null
                }
            };
            
            localStorage.setItem(userKey, JSON.stringify(resetData));
            console.log('Данные сброшены для пользователя:', userKey);
            
            return resetData;
        }

        function initializeUserInterface() {
            if (user) {
                if (user.photo_url) {
                    document.getElementById('avatar').style.backgroundImage = `url(${user.photo_url})`;
                    document.getElementById('avatar').textContent = '';
                }
                if (user.username) {
                    document.getElementById('username').textContent = user.username;
                } else {
                    document.getElementById('username').textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim() || 'Пользователь';
                }
                document.getElementById('user-id').textContent = `ID: ${user.id}`;
            } else {
                document.getElementById('avatar').textContent = 'U';
                document.getElementById('username').textContent = 'Пользователь';
                document.getElementById('user-id').textContent = 'ID: не указан';
            }
        }

        initializeUserInterface();
        let userData = getUserData();
        let tokens = userData.tokens || 0;
        let inventory = userData.inventory || [];
        let miningData = userData.mining || {
            active: false,
            startTime: null,
            totalMined: 0,
            lastRewardTime: null
        };

        const mineButton = document.getElementById('mineButton');
        const balanceElement = document.getElementById('balance');
        const timerElement = document.getElementById('timer');
        const inventoryGrid = document.getElementById('inventory-grid');
        const inventoryCount = document.getElementById('inventory-count');
        const withdrawButton = document.getElementById('withdrawButton');
        const specialBonusElement = document.getElementById('specialBonus');
        const adminRefreshButton = document.getElementById('adminRefreshButton');
        const adminResetButton = document.getElementById('adminResetButton');
        const resetModal = document.getElementById('resetModal');
        const miningTimeElement = document.getElementById('miningTime');
        const miningProgressBar = document.getElementById('miningProgressBar');
        const minedAmountElement = document.getElementById('minedAmount');
        const nextRewardElement = document.getElementById('nextReward');

        let miningInterval = null;
        let rewardInterval = null;

        if (userData.isSpecialUser) {
            specialBonusElement.textContent = '⭐ Владелец бота';
            adminRefreshButton.style.display = 'block';
            adminResetButton.style.display = 'block';
            console.log('Обнаружен владелец бота!');
        }

        const rewards = [
            { 
                image: 'https://s.iimg.su/s/08/gHCfLJrxWk6T7YSleWFZQ6mhNmMizJNwOALAU0er.png', 
                name: 'Шляпа', 
                value: 1300,
                chance: 1
            },
            { 
                image: 'https://s.iimg.su/s/08/gG2ENFkxrVGCwWokHcaaIp6HnzEbezCw9qsc1FZm.png', 
                name: 'Подарок', 
                value: 25,
                chance: 51
            },
            { 
                image: 'https://s.iimg.su/s/08/gcunIRixc1LSpuflhT9yHKb80ySAGNgHGs8tnzAf.png', 
                name: 'Кольцо', 
                value: 100,
                chance: 24
            },
            { 
                image: 'https://s.iimg.su/s/08/gGJh283xtNVKXiOBgKUzyuBkGmpiSe9uQsy6XYfI.png', 
                name: 'Алмаз', 
                value: 100,
                chance: 24
            }
        ];

        const boxRewards = {
            150: [
                { value: 50, chance: 40 },
                { value: 100, chance: 30 },
                { value: 200, chance: 20 },
                { value: 300, chance: 10 }
            ],
            300: [
                { value: 100, chance: 35 },
                { value: 200, chance: 30 },
                { value: 400, chance: 20 },
                { value: 600, chance: 15 }
            ],
            500: [
                { value: 200, chance: 30 },
                { value: 400, chance: 25 },
                { value: 700, chance: 25 },
                { value: 1000, chance: 20 }
            ],
            1000: [
                { value: 500, chance: 25 },
                { value: 800, chance: 25 },
                { value: 1200, chance: 25 },
                { value: 2000, chance: 25 }
            ]
        };

        function adminAddStars() {
            if (!userData.isSpecialUser) return;
            
            tokens += 5000;
            updateBalance();
            
            showRewardMessage('+5000 звёзд! 🎉', '#4CAF50');
            console.log('Админ добавил 5000 звёзд. Новый баланс:', tokens);
        }

        function requestReset() {
            if (!userData.isSpecialUser) return;
            resetModal.style.display = 'flex';
        }

        function confirmReset() {
            const newUserData = resetUserData();
            userData = newUserData;
            tokens = userData.tokens;
            inventory = userData.inventory;
            miningData = userData.mining;
            
            stopMining();
            updateBalance();
            updateInventory();
            updateMiningUI();
            resetModal.style.display = 'none';
            
            showRewardMessage('Данные сброшены! 🔄', '#4CAF50');
            console.log('Данные сброшены. Новый баланс:', tokens);
        }

        function cancelReset() {
            resetModal.style.display = 'none';
        }

        function getRandomReward(boxPrice) {
            const rewards = boxRewards[boxPrice];
            const totalChance = rewards.reduce((sum, item) => sum + item.chance, 0);
            let random = Math.random() * totalChance;
            
            for (let item of rewards) {
                if (random < item.chance) {
                    return item;
                }
                random -= item.chance;
            }
            
            return rewards[rewards.length - 1];
        }

        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(`${pageName}-page`).classList.add('active');
            document.querySelector(`.nav-button[onclick="showPage('${pageName}')"]`).classList.add('active');
            
            if (pageName === 'inventory') {
                updateInventory();
            }
        }

        function updateBalance() {
            balanceElement.textContent = tokens;
            
            const saveData = {
                tokens: tokens,
                inventory: inventory,
                initialized: true,
                isSpecialUser: userData.isSpecialUser,
                mining: miningData
            };
            
            saveUserData(saveData);
        }

        function updateInventory() {
            inventoryGrid.innerHTML = '';
            inventoryCount.textContent = inventory.length;
            
            if (inventory.length === 0) {
                inventoryGrid.innerHTML = '<div class="empty-inventory">Инвентарь пуст</div>';
            } else {
                inventory.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.innerHTML = `
                        <img src="${item.image}" alt="${item.name}" class="inventory-image no-copy">
                        <div class="item-value">${item.value} звёзд</div>
                        <button class="sell-button" onclick="sellItem(${index})">Продать</button>
                    `;
                    inventoryGrid.appendChild(itemElement);
                });
            }
            
            withdrawButton.disabled = inventory.length === 0;
        }

        function sellItem(index) {
            const item = inventory[index];
            tokens += item.value;
            inventory.splice(index, 1);
            
            updateBalance();
            updateInventory();
            
            showRewardMessage(`Продано за ${item.value} токенов!`);
        }

        function showRewardMessage(message, color = '#ffd700') {
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            messageElement.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(43, 82, 120, 0.9);
                color: ${color};
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: bold;
                font-size: 18px;
                z-index: 1001;
                animation: fadeInOut 2s ease-in-out;
            `;
            
            document.body.appendChild(messageElement);
            
            setTimeout(() => {
                document.body.removeChild(messageElement);
            }, 2000);
        }

        function openBox(price) {
            if (tokens < price) {
                showRewardMessage(`Недостаточно звёзд! Нужно ${price}`, '#ff4444');
                return;
            }

            tokens -= price;
            updateBalance();

            const reward = getRandomReward(price);
            tokens += reward.value;
            updateBalance();

            showRewardMessage(`+${reward.value} звёзд из бокса! 🎁`, '#4CAF50');
        }

        function startMining() {
            if (miningData.active) return;
            
            miningData.active = true;
            miningData.startTime = Date.now();
            miningData.lastRewardTime = Date.now();
            miningData.totalMined = 0;
            
            mineButton.disabled = true;
            mineButton.textContent = 'Майнинг активен...';
            
            updateMiningUI();
            startMiningTimers();
            
            const saveData = {
                tokens: tokens,
                inventory: inventory,
                initialized: true,
                isSpecialUser: userData.isSpecialUser,
                mining: miningData
            };
            
            saveUserData(saveData);
        }

        function stopMining() {
            miningData.active = false;
            mineButton.disabled = false;
            mineButton.textContent = 'Начать майнинг';
            
            if (miningInterval) {
                clearInterval(miningInterval);
                miningInterval = null;
            }
            
            if (rewardInterval) {
                clearInterval(rewardInterval);
                rewardInterval = null;
            }
            
            updateMiningUI();
        }

        function startMiningTimers() {
            miningInterval = setInterval(updateMiningUI, 1000);

            rewardInterval = setInterval(() => {
                if (!miningData.active) return;
                
                const rewards = [0.2, 0.5, 0.1, 0.7];
                const randomReward = rewards[Math.floor(Math.random() * rewards.length)];
                
                tokens += randomReward;
                miningData.totalMined += randomReward;
                miningData.lastRewardTime = Date.now();
                
                updateBalance();
                updateMiningUI();
                
                showRewardMessage(`+${randomReward.toFixed(1)} звёзд! ⛏️`, '#4CAF50');
                
            }, 10 * 60 * 1000); 
        }

        function updateMiningUI() {
            if (!miningData.active) {
                miningTimeElement.textContent = 'Майнинг не запущен';
                miningProgressBar.style.width = '0%';
                minedAmountElement.textContent = 'Добыто: 0';
                nextRewardElement.textContent = 'Следующая награда: 00:10:00';
                return;
            }
            
            const now = Date.now();
            const elapsed = now - miningData.startTime;
            const totalTime = 3 * 60 * 60 * 1000; 
            
            const progress = Math.min((elapsed / totalTime) * 100, 100);
            miningProgressBar.style.width = progress + '%';
            
            const timeLeft = Math.max(totalTime - elapsed, 0);
            const hoursLeft = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const secondsLeft = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            miningTimeElement.textContent = `Майнинг активен: ${formatTime(hoursLeft)}:${formatTime(minutesLeft)}:${formatTime(secondsLeft)}`;
            
            const timeToNextReward = Math.max(10 * 60 * 1000 - (now - miningData.lastRewardTime), 0);
            const minutesToReward = Math.floor(timeToNextReward / (1000 * 60));
            const secondsToReward = Math.floor((timeToNextReward % (1000 * 60)) / 1000);

            nextRewardElement.textContent = `Следующая награда: ${formatTime(minutesToReward)}:${formatTime(secondsToReward)}`;
            minedAmountElement.textContent = `Добыто: ${miningData.totalMined.toFixed(1)}`;

            if (elapsed >= totalTime) {
                stopMining();
                showRewardMessage('Майнинг завершен! 🎉', '#4CAF50');
            }
        }

        function formatTime(time) {
            return time < 10 ? '0' + time : time;
        }

        function checkExistingMining() {
            if (miningData.active && miningData.startTime) {
                const now = Date.now();
                const elapsed = now - miningData.startTime;
                const totalTime = 3 * 60 * 60 * 1000;
                
                if (elapsed < totalTime) {
                    startMiningTimers();
                    mineButton.disabled = true;
                    mineButton.textContent = 'Майнинг активен...';
                } else {
                    stopMining();
                    miningData.active = false;
                }
            }
        }

        mineButton.addEventListener('click', startMining);
        withdrawButton.addEventListener('click', function() {
            alert('Функция вывода скоро будет доступна!');
        });
        adminRefreshButton.addEventListener('click', adminAddStars);
        adminResetButton.addEventListener('click', requestReset);

        let startY = 0;
        let currentY = 0;

        inventoryGrid.addEventListener('touchstart', function(e) {
            startY = e.touches[0].clientY;
        });

        inventoryGrid.addEventListener('touchmove', function(e) {
            currentY = e.touches[0].clientY;
        });

        inventoryGrid.addEventListener('touchend', function(e) {
            const diff = startY - currentY;
            if (diff > 50) {
                inventoryGrid.scrollBy({ top: 100, behavior: 'smooth' });
            }
            else if (diff < -50) {
                inventoryGrid.scrollBy({ top: -100, behavior: 'smooth' });
            }
        });

        updateBalance();
        updateInventory();
        checkExistingMining();
        updateMiningUI();

        console.log('=== СИСТЕМА ИНИЦИАЛИЗИРОВАНА ===');
        console.log('Текущий пользователь:', user);
        console.log('ID пользователя:', user ? user.id : 'неизвестно');
        console.log('Мой ID:', MY_TELEGRAM_ID);
        console.log('Это владелец:', userData.isSpecialUser);
        console.log('Текущие токены:', tokens);
        console.log('Размер инвентаря:', inventory.length);
        console.log('Статус майнинга:', miningData.active);
        console.log('============================');

        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -60%); }
                20% { opacity: 1; transform: translate(-50%, -50%); }
                80% { opacity: 1; transform: translate(-50%, -50%); }
                100% { opacity: 0; transform: translate(-50%, -40%); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>


